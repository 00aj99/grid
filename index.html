<html>
<head>
  <link rel="stylesheet" href="demo/style.css" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
  <script src="spec/fixtures.js"></script>
  <script src="lib/gridList.js"></script>
  <script src="lib/jquery.gridList.js"></script>
  <script>

var buildGridElements = function($gridContainer, items) {
  var item, i;
  for (i = 0; i < items.length; i++) {
    item = items[i];
    $item = $(
      '<li>' +
        '<div class="inner">' +
          '<div class="controls">' +
            '<a href="#" class="resize" data-size="1">1x</a>' +
            '<a href="#" class="resize" data-size="2">2x</a>' +
            '<a href="#" class="resize" data-size="3">3x</a>' +
          '</div>' +
          i +
        '</div>' +
      '</li>'
    );
    $item.attr({
      'data-w': item.w,
      'data-h': item.h,
      'data-x': item.x,
      'data-y': item.y
    });
    $gridContainer.append($item);
  }
};

var currentGridSize = 4;
var updateGridSize = function() {
  $('#grid').gridList('resize', currentGridSize);
};

$(function() {
  buildGridElements($('#grid'), fixtures.COLUMN_GROUPS_1.initial);

  var gridList = $('#grid').gridList({
    rows: currentGridSize,
    widthHeightRatio: 264 / 294,
    heightToFontSizeRatio: 0.25,
    columnsPerGroup: 3,
    onChange: function(changedItems) {
      // Hack to flash changed items visually
      for (var i = 0; i < changedItems.length; i++) {
        (function($element) {
          $element.addClass('changed')
          setTimeout(function() {
            $element.removeClass('changed');
          }, 0);
        })(changedItems[i].$element);
      }
    }
  });

  //updateGridSize();
  var i, elem;

  for (i = 0; i < 50; i++) {
    elem = $('<li></li>');
    elem.css({
      'width': 1,
      'height': 10000,
      'backgroundColor': 'red',
      'position': 'absolute',
      'top': 0,
      'left': i * 3 * window._cellWidth
    });

    $('.grid-container ul.grid').append(elem);
  }

  $('#grid li .resize').click(function(e) {
    e.preventDefault();
    var itemElement = $(e.currentTarget).closest('li'),
        itemSize = $(e.currentTarget).data('size');
    $('#grid').gridList('resizeItem', itemElement, itemSize);
  });
  $('.button-minus').click(function(e) {
    e.preventDefault();
    currentGridSize++;
    updateGridSize();
  });
  $('.button-plus').click(function(e) {
    e.preventDefault();
    currentGridSize = Math.max(1, currentGridSize - 1);
    updateGridSize();
  });
});

$(window).resize(function() {
  $('#grid').gridList('resize', currentGridSize);
});


  </script>
</head>
<body>
  <div class="header">
    <a href="#remove-row" class="button remove-row">-</a>
    <a href="#add-row" class="button add-row">+</a>
  </div>
  <div class="grid-container">
    <ul id="grid" class="grid">
      <li class="position-highlight">
        <div class="inner"></div>
      </li>
    </ul>
  </div>
</body>
